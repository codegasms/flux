<div class="px-8 w-full overflow-y-scroll no-scrollbar">
  <!-- My Storage Header -->
  <div class="flex justify-between w-full my-4">
    <h1 class="text-[24px] font-['Quicksand'] font-bold">My Storage</h1>
    <button class="btn btn-ghost bg-base-100 font-bold rounded-full flex justify-center items-center " id="toggleAnalytics">
      <span class="material-symbols-outlined"> insert_chart </span>
    </button>
  </div>
  <!-- Analytics -->
  <div class="bg-base-100 rounded-[16px] p-6 scale-1 transition-all" id="analytics">
    <div class="w-full">
      <h1 class="text-[24px] font-['Quicksand'] font-bold">Overview</h1>
    </div>
    <canvas id="myChart" height="60" aria-label="Graph for storage analytics">
      <p>Your browser does not support the canvas element.</p>
    </canvas>
  </div>
  <div class="w-full rounded-[16px] mt-5 bg-base-100 mb-6 transition-all">
    <div class="px-8 py-6 w-full">
      <h1 class="text-[24px] font-['Quicksand'] font-bold">My Files</h1>
      <!-- Breadcrumbs -->
      <div class="text-sm breadcrumbs">
        <ul>
          <li><a>Home</a></li>
          <li><a>Documents</a></li>
          <li>Add Document</li>
        </ul>
      </div>
      <!-- Folders -->
      <div class="flex flex-wrap mt-4 gap-x-4">
        <%
          var folderData = [];
          async function fetchData1() { 
            const response = await fetch(params.server_url + '/spaces/meta', { 
              method: 'POST', 
              headers: {
                'accept': 'application/json',
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + params.cookies.accessToken, 
            },
            body: JSON.stringify({spaceParent: path, fileName:""}),
           })
            .then((res) => res.json());
            // console.log(response);
            folderData = response;
          }
          async function fetchData2() {
            const response = await fetch(params.server_url + '/spaces/meta/' + path, {
              method: 'GET',
              headers: {
              'accept': 'application/json',
              'Authorization': 'Bearer ' + params.cookies.accessToken,
              },
            })
            .then((res) => res.json());
            // console.log(response.slice(1));
            folderData = response.slice(1);
          }
          if(path === "/"){
            await fetchData1();
          } else {
            await fetchData2();
          }

          function formatBytes(bytes, decimals = 2) {
          if (bytes === 0) return '0 Bytes';

          const k = 1024;
          const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];

          const i = Math.floor(Math.log(bytes) / Math.log(k));

          return parseFloat((bytes / Math.pow(k, i)).toFixed(decimals)) + ' ' + sizes[i];
          }

        folderData.forEach(folder => { 
            if(folder.isDir){ %>
        <button class="btn btn-ghost btn-xs sm:btn-sm md:btn-md lg:btn-lg border-2 border-base-200 flex gap-4 my-2" onclick="window.location.href='/space/<%= folder._id %>'">
          <img src="/images/space/folder_closed.png" />
          <%= folder.fileName %>
        </button>
        <% }}); %>

      </div>
      <!-- Files -->
      <div class="mt-2">
        <table class="table">
          <tr>
            <th>File Name</th>
            <th>Access</th>
            <th>Date Created</th>
            <th>Folder</th>
            <th>Size</th>
          </tr>
          <% folderData.forEach( entry => { %>
          <% if(!entry.isDir){ %>
          <tr>
            <td><a class="download" href="#" id="<%= entry._id %>"><%= entry.fileName %></a></td>
            <td><%= entry.visibility %></td>
            <td><%= entry.created.slice(0, 10) %></td>
            <td><%= entry.spaceParent %></td>
            <td><%= formatBytes(entry.size)%> </td>
          </tr>
          <% } %>
          <% }); %>
        </table>
      </div>
    </div>
  </div>
</div>